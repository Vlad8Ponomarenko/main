<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Система Управління Розкладом в Університеті</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        h2 {
            border-bottom: 2px solid #ccc;
            padding-bottom: 5px;
        }
        form {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #ddd;
        }
        label {
            display: block;
            margin-top: 10px;
        }
        input, select, button {
            padding: 5px;
            margin-top: 5px;
            width: 100%;
            max-width: 300px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f4f4f4;
        }
        .error {
            color: red;
            margin-top: 10px;
        }
        .success {
            color: green;
            margin-top: 10px;
        }
    </style>
</head>
<body>

    <h1>Система Управління Розкладом в Університеті</h1>

    <!-- Додавання Професора -->
    <h2>Додати Професора</h2>
    <form id="addProfessorForm">
        <label for="professorId">ID Професора:</label>
        <input type="number" id="professorId" required>

        <label for="professorName">Ім'я Професора:</label>
        <input type="text" id="professorName" required>

        <label for="professorDept">Кафедра:</label>
        <input type="text" id="professorDept" required>

        <button type="submit">Додати Професора</button>
        <div id="addProfessorMessage"></div>
    </form>

    <!-- Додавання Аудиторії -->
    <h2>Додати Аудиторію</h2>
    <form id="addClassroomForm">
        <label for="classroomNumber">Номер Аудиторії:</label>
        <input type="text" id="classroomNumber" required>

        <label for="classroomCapacity">Місткість:</label>
        <input type="number" id="classroomCapacity" required>

        <label for="classroomProjector">Має Проектор:</label>
        <select id="classroomProjector" required>
            <option value="true">Так</option>
            <option value="false">Ні</option>
        </select>

        <button type="submit">Додати Аудиторію</button>
        <div id="addClassroomMessage"></div>
    </form>

    <!-- Додавання Курсу -->
    <h2>Додати Курс</h2>
    <form id="addCourseForm">
        <label for="courseId">ID Курсу:</label>
        <input type="number" id="courseId" required>

        <label for="courseName">Назва Курсу:</label>
        <input type="text" id="courseName" required>

        <label for="courseType">Тип Курсу:</label>
        <select id="courseType" required>
            <option value="Lecture">Лекція</option>
            <option value="Seminar">Семінар</option>
            <option value="Lab">Лабораторія</option>
            <option value="Practice">Практика</option>
        </select>

        <button type="submit">Додати Курс</button>
        <div id="addCourseMessage"></div>
    </form>

    <!-- Додавання Заняття -->
    <h2>Додати Заняття</h2>
    <form id="addLessonForm">
        <label for="lessonId">ID Заняття:</label>
        <input type="number" id="lessonId" required>

        <label for="lessonCourse">Курс:</label>
        <select id="lessonCourse" required></select>

        <label for="lessonProfessor">Професор:</label>
        <select id="lessonProfessor" required></select>

        <label for="lessonClassroom">Аудиторія:</label>
        <select id="lessonClassroom" required></select>

        <label for="lessonDay">День Тижня:</label>
        <select id="lessonDay" required>
            <option value="Monday">Понеділок</option>
            <option value="Tuesday">Вівторок</option>
            <option value="Wednesday">Середа</option>
            <option value="Thursday">Четвер</option>
            <option value="Friday">П'ятниця</option>
        </select>

        <label for="lessonTime">Час:</label>
        <select id="lessonTime" required>
            <option value="8:30-10:00">8:30-10:00</option>
            <option value="10:15-11:45">10:15-11:45</option>
            <option value="12:15-13:45">12:15-13:45</option>
            <option value="14:00-15:30">14:00-15:30</option>
            <option value="15:45-17:15">15:45-17:15</option>
        </select>

        <button type="submit">Додати Заняття</button>
        <div id="addLessonMessage"></div>
    </form>

    <!-- Відображення Розкладу -->
    <h2>Розклад Занять</h2>
    <table id="scheduleTable">
        <thead>
            <tr>
                <th>ID Заняття</th>
                <th>Курс</th>
                <th>Професор</th>
                <th>Аудиторія</th>
                <th>День</th>
                <th>Час</th>
                <th>Дії</th>
            </tr>
        </thead>
        <tbody>
            <!-- Розклад буде тут -->
        </tbody>
    </table>

    <!-- Звіти та Аналіз -->
    <h2>Звіти та Аналіз</h2>
    <div>
        <h3>Відсоток Використання Аудиторії</h3>
        <form id="utilizationForm">
            <label for="utilizationClassroom">Аудиторія:</label>
            <select id="utilizationClassroom" required></select>
            <button type="submit">Отримати Використання</button>
        </form>
        <div id="utilizationResult"></div>
    </div>

    <div>
        <h3>Найпопулярніший Тип Занять</h3>
        <button id="popularCourseTypeBtn">Визначити</button>
        <div id="popularCourseTypeResult"></div>
    </div>

    <script>
        // ===============================================
        // 1. Визначення базових типів (у вигляді JSDoc)
        // ===============================================

        /**
         * @typedef {"Monday" | "Tuesday" | "Wednesday" | "Thursday" | "Friday"} DayOfWeek
         */

        /**
         * @typedef {"8:30-10:00" | "10:15-11:45" | "12:15-13:45" | "14:00-15:30" | "15:45-17:15"} TimeSlot
         */

        /**
         * @typedef {"Lecture" | "Seminar" | "Lab" | "Practice"} CourseType
         */

        /**
         * @typedef {Object} Professor
         * @property {number} id
         * @property {string} name
         * @property {string} department
         */

        /**
         * @typedef {Object} Classroom
         * @property {string} number
         * @property {number} capacity
         * @property {boolean} hasProjector
         */

        /**
         * @typedef {Object} Course
         * @property {number} id
         * @property {string} name
         * @property {CourseType} type
         */

        /**
         * @typedef {Object} Lesson
         * @property {number} id
         * @property {number} courseId
         * @property {number} professorId
         * @property {string} classroomNumber
         * @property {DayOfWeek} dayOfWeek
         * @property {TimeSlot} timeSlot
         */

        /**
         * @typedef {Object} ScheduleConflict
         * @property {"ProfessorConflict" | "ClassroomConflict"} type
         * @property {Lesson} lessonDetails
         */

        // ===============================================
        // 2. Створення основних структур
        // ===============================================

        /** @type {Professor[]} */
        let professors = [];

        /** @type {Classroom[]} */
        let classrooms = [];

        /** @type {Course[]} */
        let courses = [];

        /** @type {Lesson[]} */
        let schedule = [];

        // ===============================================
        // 3. Робота з DOM елементами
        // ===============================================

        // Форма додавання професора
        const addProfessorForm = document.getElementById('addProfessorForm');
        const addProfessorMessage = document.getElementById('addProfessorMessage');

        // Форма додавання аудиторії
        const addClassroomForm = document.getElementById('addClassroomForm');
        const addClassroomMessage = document.getElementById('addClassroomMessage');

        // Форма додавання курсу
        const addCourseForm = document.getElementById('addCourseForm');
        const addCourseMessage = document.getElementById('addCourseMessage');

        // Форма додавання заняття
        const addLessonForm = document.getElementById('addLessonForm');
        const addLessonMessage = document.getElementById('addLessonMessage');

        // Таблиця розкладу
        const scheduleTableBody = document.querySelector('#scheduleTable tbody');

        // Форма для отримання використання аудиторії
        const utilizationForm = document.getElementById('utilizationForm');
        const utilizationResult = document.getElementById('utilizationResult');
        const utilizationClassroomSelect = document.getElementById('utilizationClassroom');

        // Кнопка для визначення найпопулярнішого типу курсу
        const popularCourseTypeBtn = document.getElementById('popularCourseTypeBtn');
        const popularCourseTypeResult = document.getElementById('popularCourseTypeResult');

        // ===============================================
        // 4. Функції для роботи з даними
        // ===============================================

        /**
         * Додає професора
         * @param {Professor} professor 
         */
        function addProfessor(professor) {
            if (professors.some(p => p.id === professor.id)) {
                throw new Error(`Професор з ID ${professor.id} вже існує.`);
            }
            professors.push(professor);
        }

        /**
         * Додає аудиторію
         * @param {Classroom} classroom 
         */
        function addClassroom(classroom) {
            if (classrooms.some(c => c.number === classroom.number)) {
                throw new Error(`Аудиторія з номером ${classroom.number} вже існує.`);
            }
            classrooms.push(classroom);
        }

        /**
         * Додає курс
         * @param {Course} course 
         */
        function addCourse(course) {
            if (courses.some(c => c.id === course.id)) {
                throw new Error(`Курс з ID ${course.id} вже існує.`);
            }
            courses.push(course);
        }

        /**
         * Додає заняття до розкладу, якщо немає конфліктів
         * @param {Lesson} lesson 
         * @returns {boolean}
         */
        function addLesson(lesson) {
            const conflict = validateLesson(lesson);
            if (conflict) {
                throw new Error(`Неможливо додати заняття через конфлікт: ${conflict.type}`);
            }
            schedule.push(lesson);
            return true;
        }

        /**
         * Знаходить вільні аудиторії на певний день та час
         * @param {TimeSlot} timeSlot 
         * @param {DayOfWeek} dayOfWeek 
         * @returns {string[]}
         */
        function findAvailableClassrooms(timeSlot, dayOfWeek) {
            const allClassrooms = classrooms.map(c => c.number);
            const occupied = schedule
                .filter(lesson => lesson.timeSlot === timeSlot && lesson.dayOfWeek === dayOfWeek)
                .map(lesson => lesson.classroomNumber);
            return allClassrooms.filter(number => !occupied.includes(number));
        }

        /**
         * Отримує розклад для конкретного професора
         * @param {number} professorId 
         * @returns {Lesson[]}
         */
        function getProfessorSchedule(professorId) {
            return schedule.filter(lesson => lesson.professorId === professorId);
        }

        /**
         * Перевіряє наявність конфліктів для заняття
         * @param {Lesson} lesson 
         * @returns {ScheduleConflict|null}
         */
        function validateLesson(lesson) {
            // Конфлікт для професора
            const professorConflict = schedule.find(existingLesson => 
                existingLesson.professorId === lesson.professorId &&
                existingLesson.dayOfWeek === lesson.dayOfWeek &&
                existingLesson.timeSlot === lesson.timeSlot
            );
            if (professorConflict) {
                return {
                    type: "ProfessorConflict",
                    lessonDetails: professorConflict
                };
            }

            // Конфлікт для аудиторії
            const classroomConflict = schedule.find(existingLesson => 
                existingLesson.classroomNumber === lesson.classroomNumber &&
                existingLesson.dayOfWeek === lesson.dayOfWeek &&
                existingLesson.timeSlot === lesson.timeSlot
            );
            if (classroomConflict) {
                return {
                    type: "ClassroomConflict",
                    lessonDetails: classroomConflict
                };
            }

            return null;
        }

        /**
         * Отримує відсоток використання аудиторії
         * @param {string} classroomNumber 
         * @returns {number}
         */
        function getClassroomUtilization(classroomNumber) {
            const totalSlots = 5 * 5; // 5 днів, 5 слотів на день
            const usedSlots = schedule.filter(lesson => lesson.classroomNumber === classroomNumber).length;
            return ((usedSlots / totalSlots) * 100).toFixed(2);
        }

        /**
         * Визначає найпопулярніший тип курсу
         * @returns {CourseType|null}
         */
        function getMostPopularCourseType() {
            if (courses.length === 0) return null;

            const typeCount = {};

            schedule.forEach(lesson => {
                const course = courses.find(c => c.id === lesson.courseId);
                if (course) {
                    typeCount[course.type] = (typeCount[course.type] || 0) + 1;
                }
            });

            let mostPopular = null;
            let maxCount = 0;
            for (const type in typeCount) {
                if (typeCount[type] > maxCount) {
                    maxCount = typeCount[type];
                    mostPopular = type;
                }
            }

            return mostPopular;
        }

        /**
         * Змінює аудиторію для заняття, якщо немає конфліктів
         * @param {number} lessonId 
         * @param {string} newClassroomNumber 
         * @returns {boolean}
         */
        function reassignClassroom(lessonId, newClassroomNumber) {
            const lessonIndex = schedule.findIndex(lesson => lesson.id === lessonId);
            if (lessonIndex === -1) throw new Error(`Заняття з ID ${lessonId} не знайдено.`);

            const updatedLesson = { ...schedule[lessonIndex], classroomNumber: newClassroomNumber };
            const conflict = validateLesson(updatedLesson);
            if (conflict) {
                throw new Error(`Неможливо змінити аудиторію через конфлікт: ${conflict.type}`);
            }

            schedule[lessonIndex] = updatedLesson;
            return true;
        }

        /**
         * Видаляє заняття з розкладу
         * @param {number} lessonId 
         */
        function cancelLesson(lessonId) {
            const lessonIndex = schedule.findIndex(lesson => lesson.id === lessonId);
            if (lessonIndex === -1) throw new Error(`Заняття з ID ${lessonId} не знайдено.`);
            schedule.splice(lessonIndex, 1);
        }

        // ===============================================
        // 5. Функції для оновлення UI
        // ===============================================

        /**
         * Оновлює таблицю розкладу
         */
        function updateScheduleTable() {
            // Очистити таблицю
            scheduleTableBody.innerHTML = '';

            // Додати кожне заняття
            schedule.forEach(lesson => {
                const course = courses.find(c => c.id === lesson.courseId);
                const professor = professors.find(p => p.id === lesson.professorId);

                const row = document.createElement('tr');

                row.innerHTML = `
                    <td>${lesson.id}</td>
                    <td>${course ? course.name : 'Не знайдено'}</td>
                    <td>${professor ? professor.name : 'Не знайдено'}</td>
                    <td>${lesson.classroomNumber}</td>
                    <td>${lesson.dayOfWeek}</td>
                    <td>${lesson.timeSlot}</td>
                    <td>
                        <button onclick="deleteLesson(${lesson.id})">Видалити</button>
                        <button onclick="changeClassroom(${lesson.id})">Змінити Аудиторію</button>
                    </td>
                `;
                scheduleTableBody.appendChild(row);
            });

            // Оновити селекти для розкладу
            populateLessonSelects();
            populateUtilizationSelect();
        }

        /**
         * Оновлює списки в селектах для додавання заняття
         */
        function populateLessonSelects() {
            const lessonCourseSelect = document.getElementById('lessonCourse');
            const lessonProfessorSelect = document.getElementById('lessonProfessor');
            const lessonClassroomSelect = document.getElementById('lessonClassroom');

            // Очистити існуючі опції
            lessonCourseSelect.innerHTML = '';
            lessonProfessorSelect.innerHTML = '';
            lessonClassroomSelect.innerHTML = '';

            // Додати опції курсів
            courses.forEach(course => {
                const option = document.createElement('option');
                option.value = course.id;
                option.textContent = `${course.name} (${course.type})`;
                lessonCourseSelect.appendChild(option);
            });

            // Додати опції професорів
            professors.forEach(prof => {
                const option = document.createElement('option');
                option.value = prof.id;
                option.textContent = `${prof.name} (${prof.department})`;
                lessonProfessorSelect.appendChild(option);
            });

            // Додати опції аудиторій
            classrooms.forEach(classroom => {
                const option = document.createElement('option');
                option.value = classroom.number;
                option.textContent = `${classroom.number} (Вмісткість: ${classroom.capacity})`;
                lessonClassroomSelect.appendChild(option);
            });
        }

        /**
         * Оновлює селект для використання аудиторії
         */
        function populateUtilizationSelect() {
            utilizationClassroomSelect.innerHTML = '';
            classrooms.forEach(classroom => {
                const option = document.createElement('option');
                option.value = classroom.number;
                option.textContent = `${classroom.number}`;
                utilizationClassroomSelect.appendChild(option);
            });
        }

        /**
         * Оновлює селект аудиторій при зміні
         */
        function updateClassroomOptions() {
            populateLessonSelects();
            populateUtilizationSelect();
        }

        // ===============================================
        // 6. Обробка подій форм
        // ===============================================

        // Обробка додавання професора
        addProfessorForm.addEventListener('submit', function(event) {
            event.preventDefault();
            const id = parseInt(document.getElementById('professorId').value);
            const name = document.getElementById('professorName').value.trim();
            const department = document.getElementById('professorDept').value.trim();

            try {
                addProfessor({ id, name, department });
                addProfessorMessage.textContent = 'Професора додано успішно.';
                addProfessorMessage.className = 'success';
                addProfessorForm.reset();
                updateScheduleTable();
            } catch (error) {
                addProfessorMessage.textContent = error.message;
                addProfessorMessage.className = 'error';
            }
        });

        // Обробка додавання аудиторії
        addClassroomForm.addEventListener('submit', function(event) {
            event.preventDefault();
            const number = document.getElementById('classroomNumber').value.trim();
            const capacity = parseInt(document.getElementById('classroomCapacity').value);
            const hasProjector = document.getElementById('classroomProjector').value === 'true';

            try {
                addClassroom({ number, capacity, hasProjector });
                addClassroomMessage.textContent = 'Аудиторію додано успішно.';
                addClassroomMessage.className = 'success';
                addClassroomForm.reset();
                updateScheduleTable();
            } catch (error) {
                addClassroomMessage.textContent = error.message;
                addClassroomMessage.className = 'error';
            }
        });

        // Обробка додавання курсу
        addCourseForm.addEventListener('submit', function(event) {
            event.preventDefault();
            const id = parseInt(document.getElementById('courseId').value);
            const name = document.getElementById('courseName').value.trim();
            const type = document.getElementById('courseType').value;

            try {
                addCourse({ id, name, type });
                addCourseMessage.textContent = 'Курс додано успішно.';
                addCourseMessage.className = 'success';
                addCourseForm.reset();
                updateScheduleTable();
            } catch (error) {
                addCourseMessage.textContent = error.message;
                addCourseMessage.className = 'error';
            }
        });

        // Обробка додавання заняття
        addLessonForm.addEventListener('submit', function(event) {
            event.preventDefault();
            const id = parseInt(document.getElementById('lessonId').value);
            const courseId = parseInt(document.getElementById('lessonCourse').value);
            const professorId = parseInt(document.getElementById('lessonProfessor').value);
            const classroomNumber = document.getElementById('lessonClassroom').value;
            const dayOfWeek = document.getElementById('lessonDay').value;
            const timeSlot = document.getElementById('lessonTime').value;

            try {
                addLesson({ id, courseId, professorId, classroomNumber, dayOfWeek, timeSlot });
                addLessonMessage.textContent = 'Заняття додано успішно.';
                addLessonMessage.className = 'success';
                addLessonForm.reset();
                updateScheduleTable();
            } catch (error) {
                addLessonMessage.textContent = error.message;
                addLessonMessage.className = 'error';
            }
        });

        // Обробка отримання використання аудиторії
        utilizationForm.addEventListener('submit', function(event) {
            event.preventDefault();
            const classroomNumber = document.getElementById('utilizationClassroom').value;
            const utilization = getClassroomUtilization(classroomNumber);
            utilizationResult.textContent = `Відсоток використання аудиторії ${classroomNumber}: ${utilization}%`;
        });

        // Обробка визначення найпопулярнішого типу курсу
        popularCourseTypeBtn.addEventListener('click', function() {
            const popularType = getMostPopularCourseType();
            if (popularType) {
                popularCourseTypeResult.textContent = `Найпопулярніший тип курсу: ${popularType}`;
            } else {
                popularCourseTypeResult.textContent = 'Немає даних для визначення.';
            }
        });

        // ===============================================
        // 7. Функції для взаємодії з розкладом
        // ===============================================

        /**
         * Видаляє заняття з розкладу
         * @param {number} lessonId 
         */
        function deleteLesson(lessonId) {
            if (confirm(`Ви впевнені, що хочете видалити заняття з ID ${lessonId}?`)) {
                try {
                    cancelLesson(lessonId);
                    updateScheduleTable();
                    alert('Заняття видалено успішно.');
                } catch (error) {
                    alert(error.message);
                }
            }
        }

        /**
         * Змінює аудиторію для заняття
         * @param {number} lessonId 
         */
        function changeClassroom(lessonId) {
            const newClassroomNumber = prompt('Введіть новий номер аудиторії:');
            if (newClassroomNumber) {
                try {
                    reassignClassroom(lessonId, newClassroomNumber.trim());
                    updateScheduleTable();
                    alert('Аудиторію змінено успішно.');
                } catch (error) {
                    alert(error.message);
                }
            }
        }

        // ===============================================
        // 8. Ініціалізація та приклади даних
        // ===============================================

        function initializeSampleData() {
            try {
                // Додавання професорів
                addProfessor({ id: 1, name: "Dr. Іванов", department: "Комп'ютерні науки" });
                addProfessor({ id: 2, name: "Prof. Петрова", department: "Математика" });

                // Додавання аудиторій
                addClassroom({ number: "101A", capacity: 30, hasProjector: true });
                addClassroom({ number: "202B", capacity: 50, hasProjector: false });

                // Додавання курсів
                addCourse({ id: 1, name: "Алгоритми", type: "Lecture" });
                addCourse({ id: 2, name: "Калькулюс", type: "Seminar" });

                // Додавання заняття
                addLesson({
                    id: 1,
                    courseId: 1,
                    professorId: 1,
                    classroomNumber: "101A",
                    dayOfWeek: "Monday",
                    timeSlot: "8:30-10:00"
                });

                updateScheduleTable();
            } catch (error) {
                console.error("Помилка ініціалізації даних:", error.message);
            }
        }

        // Виклик функції ініціалізації при завантаженні сторінки
        window.onload = function() {
            initializeSampleData();
        };

    </script>

</body>
</html>
